version: '{branch}.{build}'
branches:
  only:
  - master
  - appveyor
  - w32

platform:
- x86
- x64

environment:
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2013
      VS: C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
      VS: C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      VS: C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvarsall.bat

install:
- if defined VS call "%VS%" %PLATFORM%

build_script:
- cmd: >-
    cd C:\projects\talloc-win
    
    mkdir build
    
    cd build
    
    cmake -G "NMake Makefiles" -D CMAKE_INSTALL_PREFIX=../output ..
    
    nmake
    
    nmake install

test_script:
- cmd: nmake test

artifacts:
  - path: output
    name: master
    type: zip
